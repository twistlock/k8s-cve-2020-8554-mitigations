{"modified":"2020-12-18T17:12:19.473Z","owner":"","name":"Mitigation for Kubernetes CVE-2020-8554 - External IPs","previousName":"","effect":"block","script":"operations = {\"CREATE\", \"UPDATE\"}\nmatch[{\"msg\": msg}] {\n input.request.kind.kind == \"Service\"\n not input.request[\"subResource\"]  # don't process changes to service/status\n operations[input.request.operation]\n newExternalIPs := {ips | ips := input.request.object.spec.externalIPs[_]} - {oldips | oldips := input.request.oldObject.spec.externalIPs[_]}\n # To whitelist specific IPs, update the following line\n allowedIPs := {\"\"} # allowedIPs := {\"IP1\", \"IP2\", ...}\n forbiddenExternalIPs := newExternalIPs - allowedIPs\n \n count(forbiddenExternalIPs) > 0\n msg := sprintf(\"Service was assigned forbidden external IPs: %v\", [forbiddenExternalIPs])\n}","description":"Block services exposing external IPs not in whitelist","skipRawReq":false,"policyType":"admission","exportTime":"12_20_20_20_24_33","exportBy":""}